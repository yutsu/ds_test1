# Deep Research Clone 設定ファイル例（改善版）
# このファイルを config.yaml にコピーして使用してください

# 言語モデル設定
language_model:
  # デフォルトモデル: ollama, openai, gemini
  default: "ollama"

  # Ollama設定
  ollama:
    model_name: "llama3.1:8b"
    base_url: "http://localhost:11434"  # 別のポートを使用する場合は変更

  # OpenAI設定
  openai:
    model: "gpt-3.5-turbo"
    max_tokens: 2000
    temperature: 0.7

  # Google Gemini設定
  gemini:
    model: "gemini-2.0-flash"
    temperature: 0.7

# 反復改善設定
iteration:
  # 最大反復回数
  max_iterations: 6

  # 初期検索結果数
  initial_search_count: 8

  # 追加検索結果数
  additional_search_count: 5

  # 追加検索クエリの最大数
  max_additional_queries: 3

# Web検索設定
search:
  # デフォルト検索エンジン: google, bing, duckduckgo
  engine: "google"

  # 検索結果数
  max_results: 5

  # レート制限設定
  rate_limit:
    requests_per_second: 2  # 1秒あたりのリクエスト数（より保守的に）
    max_retries: 5          # 最大リトライ回数（増加）
    retry_delay_base: 5     # 基本待機時間（秒）（増加）

  # Google Custom Search設定
  google:
    api_key: "${GOOGLE_SEARCH_API_KEY}"
    search_engine_id: "${GOOGLE_SEARCH_ENGINE_ID}"

# 引用管理設定
citations:
  # 引用の自動抽出を有効にする
  auto_extract: true

  # 関連度スコアの閾値
  relevance_threshold: 0.5

  # 信頼性スコアの閾値（この値未満の結果は除外）
  reliability_threshold: 0.3

  # 引用形式: numbered, author_year, url
  format: "numbered"

# 出力設定
output:
  # デフォルト出力形式: markdown, pdf, html
  format: "markdown"

  # 出力ディレクトリ
  directory: "./output"

  # ファイル名テンプレート
  filename_template: "research_{query}_{timestamp}"

  # マークダウン設定
  markdown:
    include_search_results: true
    include_analysis: true
    include_summary: true
    include_final_report: true
    include_citations: true
    include_search_history: true

# ログ設定
logging:
  level: "INFO"
  file: "deep_research.log"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

# プロンプト設定
prompts:
  analysis: |
    今日の日付情報: {today_info}

    以下の検索結果のみを基に、'{query}'について学術的な厳密性を持って分析してください。検索結果に含まれていない情報は推測せず、事実のみを記載してください。

    検索結果:
    {results_text}

    分析では以下の点を含めてください：
    - 検索結果から得られる主要な事実（重要度順）
    - 検索結果に含まれる具体的なデータや統計
    - 検索結果から読み取れる異なる視点や意見
    - 各情報の日付（検索結果に含まれる場合）と今日との関係
    - 将来の予定や過去の情報の区別
    - 検索結果からは不明な点や追加で調べるべき点

    重要：検索結果に含まれていない情報は記載せず、事実のみを記載してください。
    分析結果を日本語で詳しく記述してください。

  analysis_all: |
    今日の日付情報: {today_info}

    以下の全ての検索結果のみを基に、'{query}'について包括的な調査結果を作成してください。検索結果に含まれていない情報は推測せず、事実のみを記載してください。

    検索結果:
    {results_text}

    分析では以下の点を含めてください：
    - 検索結果から得られる主要な事実（重要度順）
    - 検索結果に含まれる具体的なデータや統計
    - 検索結果から読み取れる異なる視点や意見の比較
    - 各情報の日付（検索結果に含まれる場合）と今日との関係
    - 将来の予定や過去の情報の区別
    - 信頼性の高い情報源からの情報
    - 検索結果からは不明な点や課題

    重要：検索結果に含まれていない情報は記載せず、事実のみを記載してください。
    分析結果を日本語で詳しく記述してください。

  summary: |
    以下の分析結果のみを基に、'{query}'について簡潔な要約を作成してください。分析結果に含まれていない情報は推測せず、事実のみを記載してください。

    分析結果:
    {analysis}

    要約では以下の点を含めてください：
    - 検索結果から得られる最も重要な事実（3-5点）
    - 各事実の日付（分析結果に含まれる場合）
    - 結論（検索結果から読み取れる範囲で）

    重要：分析結果に含まれていない情報は記載せず、事実のみを記載してください。
    要約を日本語で簡潔に記述してください。

  additional_queries: |
    今日の日付情報: {today_info}

    以下の研究結果をレビューして、追加で調べるべきキーワードや検索クエリを提案してください。

    元のクエリ: {original_query}

    分析結果:
    {analysis}

    要約:
    {summary}

    以下の観点から追加検索キーワードを提案してください：
    1. 分析で言及されているが詳細が不足している概念
    2. 関連する専門用語や技術
    3. 比較対象となる他の事例やデータ
    4. 最新の情報や統計
    5. 反対意見や異なる視点
    6. 古い情報（過去の予定や発売日）について最新状況を確認するべき項目
    7. 将来の予定について最新の進捗状況を確認するべき項目

    特に、記事内で発売予定日や発表予定日が今日より前の場合は、実際の発売・発表状況を確認するための検索キーワードを提案してください。
    また、将来の予定について最新の進捗や変更がないか確認するためのキーワードも提案してください。

    各キーワードは具体的で検索しやすい形で提案してください。
    以下の形式で最大5つのキーワードを提案してください：

    キーワード1
    キーワード2
    キーワード3
    キーワード4
    キーワード5

    番号や記号は付けずに、キーワードのみを改行区切りで記載してください。

  final_report: |
    今日の日付情報: {today_info}

    以下の分析結果のみを基に、'{query}'について学術的品質の研究論文を作成してください。
    検索結果に含まれていない情報は推測せず、事実のみを記載してください。
    セクションの重複（エグゼクティブサマリーや結論など）は絶対に避け、各セクションは一度だけ記載してください。
    各セクションは300字以上、全体で2000字以上を目安に、深く・網羅的に・論理的に記述してください。

    研究論文の必須要素（必ず全て満たすこと）:
    1. 時系列の正確な理解
       - 各情報の日付を明記し、過去の事実、現在の状況、将来の予定を区別し、因果関係を明確にすること
    2. 情報源の信頼性評価
       - 公式発表、報道機関、専門家などの信頼性を評価し、一次情報と二次情報を区別し、情報の偏りや限界を明記すること
       - 信頼性スコアの高い情報源を優先的に引用し、低い情報源については注意して扱うこと
    3. 批判的思考と多角的分析
       - 異なる視点や反対意見も公平に扱い、反対意見や異論も含めて検討し、情報の矛盾点や不確実性を明記すること
    4. 学術的厳密性
       - 事実と推測を明確に区別し、適切な引用と出典の明記、論理的な構成と客観的な記述を行うこと

    レポート構成（必ずこの順で、重複なく記載）:
    1. エグゼクティブサマリー
       - 本レポートの要点を簡潔かつ網羅的にまとめる（200字程度）
       - 最も重要な発見事項と結論を明記
    2. 背景・目的
       - なぜこのテーマが重要か、調査の目的や背景を明確に
       - 研究の意義と社会的影響を説明
    3. 主要な発見事項・分析
       - 検索結果から得られた重要な事実・データ・トレンドを論理的に整理し、深掘りして解説
       - 異なる視点や意見、リスクや課題も網羅的に記載
       - 具体的な事例や数値、比較も盛り込む
       - 時系列順に情報を整理
    4. インプリケーション・示唆
       - 発見事項から導かれる経営・事業・社会への示唆や影響を考察
       - 短期的・長期的な影響を分析
       - リスクと機会の両面を評価
    5. 結論・推奨アクション
       - 調査結果から導かれる結論と、今後取るべき具体的なアクションや提言を明確に
       - 優先順位を付けた推奨事項を提示
       - 今後の研究方向や追加調査の必要性を明記
    6. 参考文献・出典
       - [1], [2] 形式で本文中に引用し、対応する情報源を明記
       - 各情報の日付（検索結果に含まれる場合）と今日との関係も明記
       - 情報源の信頼性評価も含める

    注意事項:
    - セクションの重複や再掲は禁止
    - 事実・データ・引用元に基づき、推測や主観は避ける
    - 各セクションは十分な分量・深さ・論理性・網羅性を持たせる
    - 専門用語や略語は初出時に簡単に説明
    - 文章は日本語で、学術的な品質を保つ
    - 時系列の理解を重視し、最新情報と過去情報を適切に区別する
    - 批判的思考を維持し、多角的な視点を提供する

    分析結果:
    {analysis}

    要約:
    {summary}

    利用可能な情報源:
    {citations_section}
