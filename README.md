# Deep Research Clone

言語モデルとWeb検索を組み合わせたDeep Researchのような機能を実装した研究支援ツールです。

## 🚀 新機能（改善版）

- 🔄 **反復改善検索**: レビューモデルによる追加検索で質の高いアウトプットを生成
- 📚 **詳細引用管理**: 引用元の自動抽出と関連度スコアによる管理
- ⚙️ **設定ファイル対応**: YAML設定ファイルによる柔軟なカスタマイズ
- 📄 **ファイル名重複回避**: バージョン番号とタイムスタンプによるユニークなファイル名生成

## 機能

- 🔍 **Web検索**: Google Custom Search APIを使用した検索
- 🤖 **言語モデル**: Ollama、OpenAI、Google Geminiの切り替え可能
- 📝 **マークダウン出力**: 研究結果をマークダウンファイルに保存
- 🎯 **分析・要約**: 検索結果の自動分析と要約
- 🔄 **反復改善**: レビューモデルによる追加検索キーワード生成
- 📚 **引用管理**: 自動引用抽出と詳細な引用情報管理
- ⚙️ **設定管理**: YAML設定ファイルによる柔軟な設定

## セットアップ

### 1. 依存関係のインストール

```bash
# uvを使用してインストール
uv sync

# または通常のpipを使用
pip install -r requirements.txt
```

### 2. 環境変数の設定

`env.example`を参考に`.env`ファイルを作成してください：

```bash
cp env.example .env
```

必要なAPIキーを設定：

- **Ollama**: ローカルでOllamaを起動（デフォルトで使用可能）
- **OpenAI**: OpenAI APIキーを取得して設定
- **Google Gemini**: Google APIキーを取得して設定
- **Google Search**: Google Custom Search APIキーと検索エンジンIDを設定

### 3. 設定ファイルの作成（オプション）

```bash
cp config.example.yaml config.yaml
```

設定ファイルで以下の項目をカスタマイズ可能：
- 反復回数と検索結果数
- 言語モデルのパラメータ
- 引用管理の設定
- 出力形式の設定
- ファイル名生成の設定（重複時の処理方法、タイムスタンプ形式など）

### 4. 実行

```bash
python main.py
```

## 使用方法

1. 言語モデルを選択（Ollama、OpenAI、Google Gemini）
2. 研究したいキーワードや文章を入力
3. 自動的に以下の処理が実行される：
   - 初期Web検索
   - 初期分析・要約
   - レビューモデルによる追加検索キーワード生成
   - 追加検索の実行（最大3回の反復）
   - 全結果の統合分析
   - 最終レポート生成
   - 引用の自動抽出
4. 結果がマークダウンファイルに保存される

## ファイル構成

```
├── main.py              # メインアプリケーション（改善版）
├── pyproject.toml       # プロジェクト設定（uv用）
├── requirements.txt     # 依存関係（pip用）
├── config.example.yaml  # 設定ファイル例
├── config.yaml          # 設定ファイル（要作成）
├── env.example          # 環境変数設定例
├── .env                 # 環境変数（要作成）
├── output/              # 生成されたレポートの保存先
│   ├── research_*.md    # 研究レポートファイル
│   └── ...
├── idea.md              # アイデアメモ
├── DEVELOPMENT.md       # 開発ガイド
└── README.md            # このファイル
```

## 新機能詳細

### 反復改善検索
- **レビューモデル**: 初期レポートを分析して追加検索キーワードを生成
- **追加検索**: 最大3回の反復で検索範囲を拡大
- **統合分析**: 全検索結果を統合して包括的な分析を実行

### 詳細引用管理
- **自動抽出**: 分析結果から重要な情報源を自動抽出
- **関連度スコア**: 引用の重要度を数値化（0.0-1.0）
- **詳細記録**: 検索クエリ、URL、内容を完全記録

### 設定ファイル対応
- **YAML設定**: 柔軟な設定管理
- **デフォルト値**: 設定ファイルがない場合の自動フォールバック
- **カスタマイズ可能**: プロンプト、検索設定、出力形式をカスタマイズ

### ファイル名重複回避
- **バージョン番号とタイムスタンプ**: ユニークなファイル名を生成
- **設定可能な処理方法**: timestamp（タイムスタンプのみ）、version（バージョン番号のみ）、both（両方）
- **カスタマイズ可能な形式**: タイムスタンプ形式とバージョン番号プレフィックスを設定可能
- **自動フォールバック**: 設定に応じて適切なファイル名生成方法を選択

## 対応言語モデル

### Ollama（ローカル）
- ローカルでOllamaを起動する必要があります
- デフォルトで使用可能（APIキー不要）
- 設定可能なモデル名とベースURL

### OpenAI
- GPT-3.5-turbo、GPT-4など
- APIキーが必要
- 設定可能なトークン数と温度

### Google Gemini
- Gemini 2.0 Flash
- Google APIキーが必要
- 設定可能な温度

## 出力例

改善版では以下の構成でレポートが生成され、`output/`フォルダに保存されます：

```markdown
# Deep Research: [クエリ]

## エグゼクティブサマリー
[要約]

## 最終レポート
[学術的な品質のレポート]

## 詳細分析
[包括的な分析]

## 検索履歴
### 初期検索
- クエリ: [元のクエリ]

### 追加検索
- 追加クエリ 1: [生成されたキーワード1]
- 追加クエリ 2: [生成されたキーワード2]

## 検索結果（X件）
[クエリ別にグループ化された検索結果]

## 引用文献
[詳細な引用情報]
```

**ファイル保存場所**: `output/research_[クエリ名].md`
- 同名ファイルが存在する場合は、タイムスタンプまたはバージョン番号が自動的に付与されます
- 設定ファイルで出力ディレクトリを変更可能です

## 今後の拡張予定

### 短期目標
- [x] 反復改善検索機能
- [x] 詳細引用管理
- [x] 設定ファイル対応
- [ ] PDF出力機能
- [ ] より詳細なエラーメッセージ
- [ ] ログ機能の追加

### 中期目標
- [ ] PowerPoint出力機能
- [ ] Web UI（Streamlit/FastAPI）
- [ ] バッチ処理機能
- [ ] 複数検索エンジン対応
- [ ] 検索結果のキャッシュ機能

### 長期目標
- [ ] データベース連携
- [ ] ユーザー管理
- [ ] APIサーバー化
- [ ] プラグインシステム
- [ ] 機械学習による検索最適化

## ライセンス

MIT License
